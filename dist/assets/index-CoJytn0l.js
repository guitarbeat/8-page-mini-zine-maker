import{p as b}from"./pdfjs-Pn96hxQF.js";import{E as C}from"./jspdf-C5TcOjIH.js";import T from"./html2canvas-BJcB2cAV.js";function X(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();function $(a,e){let t;return function(...s){const n=()=>{clearTimeout(t),a(...s)};clearTimeout(t),t=setTimeout(n,e)}}function A(a){return typeof a=="number"&&!isNaN(a)&&isFinite(a)}function v(a){if(!A(a))return"0 B";const e=["B","KB","MB","GB"];let t=a,i=0;for(;t>=1024&&i<e.length-1;)t/=1024,i++;return"".concat(t.toFixed(1)," ").concat(e[i])}class B{constructor(){this.pdf=null,this.isProcessing=!1}async initialize(){b.GlobalWorkerOptions.workerSrc="/pdf.worker.min.js"}validateFile(e){const t=[];if(!e)return t.push("No file selected"),{valid:!1,errors:t};e.type!=="application/pdf"&&t.push("Please select a PDF file");const i=50*1024*1024;return e.size>i&&t.push("File too large (".concat(v(e.size),"). Maximum size is ").concat(v(i))),e.size===0&&t.push("File appears to be empty"),{valid:t.length===0,errors:t}}async loadPDF(e,t=null){if(this.isProcessing)throw new Error("PDF processing already in progress");this.isProcessing=!0;try{const i=this.validateFile(e);if(!i.valid)throw new Error(i.errors.join(". "));t==null||t("Reading PDF file...");const s=await this.readFileAsArrayBuffer(e);t==null||t("Processing PDF...");const n=b.getDocument({data:s,verbosity:0}).promise,r=new Promise((o,p)=>setTimeout(()=>p(new Error("PDF loading timed out")),3e4));this.pdf=await Promise.race([n,r]);const l=this.pdf.numPages;if(l===0)throw new Error("PDF appears to be empty or corrupted");return{pdf:this.pdf,numPages:l,fileName:e.name,fileSize:e.size}}catch(i){throw console.error("PDF loading error:",i),this.handlePDFError(i)}finally{this.isProcessing=!1}}readFileAsArrayBuffer(e){return new Promise((t,i)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=()=>i(new Error("Failed to read file")),s.onabort=()=>i(new Error("File reading was cancelled")),s.readAsArrayBuffer(e)})}async renderPage(e,t=null){if(!this.pdf)throw new Error("No PDF loaded");try{t==null||t("Rendering page ".concat(e,"..."));const i=await this.pdf.getPage(e),n=i.getViewport({scale:1.5}),r=document.createElement("canvas"),l=r.getContext("2d",{alpha:!1});r.width=Math.floor(n.width),r.height=Math.floor(n.height),l.fillStyle="#ffffff",l.fillRect(0,0,r.width,r.height);const o={canvasContext:l,viewport:n,background:"white"};return await i.render(o).promise,console.log("Rendered page ".concat(e,", canvas size: ").concat(r.width,"x").concat(r.height)),r}catch(i){throw console.error("Failed to render page ".concat(e,":"),i),new Error("Failed to render page ".concat(e))}}canvasToDataURL(e,t="image/jpeg",i=.85){try{const s=e.toDataURL(t,i);return console.log("Generated data URL, format: ".concat(t,", size: ").concat(s.length," chars")),s}catch(s){return console.warn("Failed to generate ".concat(t,", falling back to PNG:"),s),e.toDataURL("image/png",1)}}canvasToBlob(e,t="image/jpeg",i=.85){return new Promise((s,n)=>{try{e.toBlob(r=>{r?(console.log("Generated blob, format: ".concat(t,", size: ").concat(r.size," bytes")),s(r)):n(new Error("Canvas to Blob conversion failed"))},t,i)}catch(r){n(r)}})}handlePDFError(e){const t=e.message||"Unknown error";return t.includes("timed out")?new Error("PDF loading timed out. The file may be corrupted or too large."):t.includes("corrupted")||t.includes("InvalidPDFException")?new Error("The PDF file appears to be corrupted or invalid."):t.includes("password")||t.includes("protected")?new Error("The PDF file is password-protected."):t.includes("not loaded")||t.includes("MissingPDFException")?new Error("PDF.js library failed to load. Please refresh the page."):new Error("PDF processing failed: ".concat(t))}cleanup(){this.pdf&&(this.pdf.destroy(),this.pdf=null),this.isProcessing=!1}}function M(a){return{all:a=a||new Map,on:function(e,t){var i=a.get(e);i?i.push(t):a.set(e,[t])},off:function(e,t){var i=a.get(e);i&&(t?i.splice(i.indexOf(t)>>>0,1):a.set(e,[]))},emit:function(e,t){var i=a.get(e);i&&i.slice().map(function(s){s(t)}),(i=a.get("*"))&&i.slice().map(function(s){s(e,t)})}}}function S(a){var e,t,i="";if(typeof a=="string"||typeof a=="number")i+=a;else if(typeof a=="object")if(Array.isArray(a)){var s=a.length;for(e=0;e<s;e++)a[e]&&(t=S(a[e]))&&(i&&(i+=" "),i+=t)}else for(t in a)a[t]&&(i&&(i+=" "),i+=t);return i}function f(){for(var a,e,t=0,i="",s=arguments.length;t<s;t++)(a=arguments[t])&&(e=S(a))&&(i&&(i+=" "),i+=e);return i}class I{constructor(){this.container=null,this.init()}init(){this.container||(this.container=document.createElement("div"),this.container.id="toast-container",this.container.className="toast-container",this.container.setAttribute("aria-live","polite"),document.body.appendChild(this.container))}show(e,t,i="",s=5e3){const n=document.createElement("div");n.className="toast toast-".concat(e),n.setAttribute("role","alert");const r=this.getIcon(e),l='\n      <div class="toast-icon">'.concat(r,'</div>\n      <div class="toast-content">\n        <div class="toast-title">').concat(t,"</div>\n        ").concat(i?'<div class="toast-message">'.concat(i,"</div>"):"",'\n      </div>\n      <button class="toast-close" aria-label="Close notification">&times;</button>\n    ');return n.innerHTML=l,this.container.appendChild(n),n.querySelector(".toast-close").addEventListener("click",()=>this.remove(n)),s>0&&setTimeout(()=>{n.parentNode&&this.remove(n)},s),requestAnimationFrame(()=>{n.classList.add("toast-visible")}),n}remove(e){e.classList.remove("toast-visible"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)}getIcon(e){const t={success:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>\n        <polyline points="22,4 12,14.01 9,11.01"/>\n      </svg>',error:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <circle cx="12" cy="12" r="10"/>\n        <line x1="15" y1="9" x2="9" y2="15"/>\n        <line x1="9" y1="9" x2="15" y2="15"/>\n      </svg>',warning:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>\n        <line x1="12" y1="9" x2="12" y2="13"/>\n        <line x1="12" y1="17" x2="12.01" y2="17"/>\n      </svg>',info:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <circle cx="12" cy="12" r="10"/>\n        <path d="M12 16v-4"/>\n        <path d="M12 8h.01"/>\n      </svg>'};return t[e]||t.info}success(e,t,i){return this.show("success",e,t,i)}error(e,t,i){return this.show("error",e,t,i)}warning(e,t,i){return this.show("warning",e,t,i)}info(e,t,i){return this.show("info",e,t,i)}}const h=new I;class Z{constructor(){this.emitter=M(),this.elements={},this.currentScale=100,this.isDarkMode=!1,this.paperSize="a4",this.orientation="landscape",this.init()}init(){this.cacheElements(),this.setupTheme(),this.loadSettings(),this.setupEventListeners(),this.setupKeyboardShortcuts()}cacheElements(){const e=t=>document.querySelector(t);this.elements={zine:e(".zine"),printBtn:e("#printBtn"),exportPdfBtn:e("#exportPdfBtn"),settingsBtn:e("#settingsBtn"),pdfUpload:e("#pdf-upload"),uploadStatus:e("#upload-status"),uploadZone:e("#upload-zone"),uploadLink:e(".upload-link"),themeToggle:e("#themeToggle"),themeIcon:e("#themeIcon"),scaleSlider:e("#scale-slider"),scaleValue:e("#scale-value"),progressContainer:e("#progress-container"),progressFill:e("#progress-fill"),progressText:e("#progress-text"),actionButtons:e("#action-buttons"),settingsPanel:e("#settings-panel"),paperSizeSelect:e("#paper-size-select"),orientationSelect:e("#orientation-select"),settingsCloseBtn:e(".settings-close"),settingsOverlay:e(".settings-overlay"),toastContainer:e("#toast-container"),zineTabs:e("#zine-tabs"),zineTab1:e("#zine-tab-1"),zineTab2:e("#zine-tab-2")}}setupTheme(){this.isDarkMode=localStorage.getItem("theme")==="dark"||!localStorage.getItem("theme")&&window.matchMedia("(prefers-color-scheme: dark)").matches,this.updateTheme(),this.updateThemeToggleAria()}updateTheme(){document.documentElement.setAttribute("data-theme",this.isDarkMode?"dark":"light"),localStorage.setItem("theme",this.isDarkMode?"dark":"light"),this.emitter.emit("themeChanged",{isDarkMode:this.isDarkMode})}toggleTheme(){this.isDarkMode=!this.isDarkMode,this.updateTheme(),this.updateThemeToggleAria(),h.info("Theme","Switched to ".concat(this.isDarkMode?"dark":"light"," mode"))}updateThemeToggleAria(){this.elements.themeToggle&&(this.elements.themeToggle.setAttribute("aria-pressed",this.isDarkMode.toString()),this.elements.themeToggle.setAttribute("aria-label","Switch to ".concat(this.isDarkMode?"light":"dark"," mode")))}setupEventListeners(){var e,t,i,s,n,r,l,o,p,u,g,c,m,w;(e=this.elements.themeToggle)==null||e.addEventListener("click",()=>this.toggleTheme()),(t=this.elements.settingsBtn)==null||t.addEventListener("click",()=>this.toggleSettings()),(i=this.elements.settingsCloseBtn)==null||i.addEventListener("click",()=>this.setSettingsVisible(!1)),(s=this.elements.settingsOverlay)==null||s.addEventListener("click",()=>this.setSettingsVisible(!1)),(n=this.elements.zineTab1)==null||n.addEventListener("click",()=>{this.setActiveTab(1),this.emitter.emit("zineTabChanged",1)}),(r=this.elements.zineTab2)==null||r.addEventListener("click",()=>{this.setActiveTab(2),this.emitter.emit("zineTabChanged",2)}),(l=this.elements.paperSizeSelect)==null||l.addEventListener("change",d=>this.updatePaperSize(d.target.value)),(o=this.elements.orientationSelect)==null||o.addEventListener("change",d=>this.updateOrientation(d.target.value)),(p=this.elements.uploadZone)==null||p.addEventListener("click",()=>this.triggerFileUpload()),(u=this.elements.uploadZone)==null||u.addEventListener("dragover",d=>this.handleDragOver(d)),(g=this.elements.uploadZone)==null||g.addEventListener("dragleave",d=>this.handleDragLeave(d)),(c=this.elements.uploadZone)==null||c.addEventListener("drop",d=>this.handleFileDrop(d)),(m=this.elements.uploadLink)==null||m.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.triggerFileUpload()}),(w=this.elements.scaleSlider)==null||w.addEventListener("input",$(d=>{this.updateScale(parseInt(d.target.value))},100)),document.addEventListener("keydown",d=>this.handleKeyboard(d))}setActiveTab(e){this.elements.zineTab1&&this.elements.zineTab2&&(this.elements.zineTab1.className=f("tab-btn",{active:e===1}),this.elements.zineTab2.className=f("tab-btn",{active:e===2}),this.elements.zineTab1.setAttribute("aria-selected",(e===1).toString()),this.elements.zineTab2.setAttribute("aria-selected",(e===2).toString()))}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{e.code==="Space"&&!e.target.matches("input, textarea, [contenteditable]")&&(e.preventDefault(),this.toggleTheme())})}triggerFileUpload(){var e;(e=this.elements.pdfUpload)==null||e.click()}handleDragOver(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&(this.elements.uploadZone.className=f(this.elements.uploadZone.className,"dragover"))}handleDragLeave(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&!this.elements.uploadZone.contains(e.relatedTarget)&&this.elements.uploadZone.classList.remove("dragover")}handleFileDrop(e){var i;e.preventDefault(),e.stopPropagation(),(i=this.elements.uploadZone)==null||i.classList.remove("dragover");const t=e.dataTransfer.files;if(t.length>0){const s=t[0];s.type==="application/pdf"?this.emitter.emit("fileSelected",{file:s,source:"drop"}):h.error("Invalid File","Please drop a PDF file")}}handleKeyboard(e){var t;e.ctrlKey&&e.key==="o"&&(e.preventDefault(),this.triggerFileUpload()),e.ctrlKey&&e.key==="p"&&(e.preventDefault(),this.emitter.emit("print")),e.ctrlKey&&e.key==="s"&&(e.preventDefault(),this.emitter.emit("export")),(e.key==="Enter"||e.key===" ")&&e.target===this.elements.uploadZone&&(e.preventDefault(),this.triggerFileUpload()),e.key==="Escape"&&!((t=this.elements.settingsPanel)!=null&&t.classList.contains("hidden"))&&(e.preventDefault(),this.setSettingsVisible(!1))}updateScale(e){this.currentScale=Math.max(50,Math.min(200,e)),this.elements.scaleValue.textContent=this.currentScale+"%",this.elements.scaleSlider.value=this.currentScale,this.elements.zine&&(this.elements.zine.classList.add("scaled"),this.elements.zine.style.transform="scale(".concat(this.currentScale/100,")")),document.querySelectorAll(".page-content").forEach(s=>{s.classList.add("scaled"),s.style.transform="scale(".concat(this.currentScale/100,")")}),document.querySelectorAll(".page-content img").forEach(s=>{s.classList.add("scaled"),s.style.transform="scale(".concat(this.currentScale/100,")")})}showProgress(e,t=0){this.elements.progressContainer&&(this.elements.progressContainer.classList.remove("hidden"),this.elements.progressText.textContent=e,this.elements.progressFill&&(this.elements.progressFill.style.width=t+"%")),this.setUploadZoneProcessing(!0)}setUploadZoneProcessing(e){this.elements.uploadZone&&(this.elements.uploadZone.className=f(this.elements.uploadZone.className,{processing:e}),e?this.elements.uploadZone.setAttribute("aria-disabled","true"):this.elements.uploadZone.removeAttribute("aria-disabled"))}hideProgress(){this.elements.progressContainer&&this.elements.progressContainer.classList.add("hidden"),this.setUploadZoneProcessing(!1)}setStatus(e,t="info"){this.elements.uploadStatus&&(this.elements.uploadStatus.textContent=e,this.elements.uploadStatus.className=f("text-center text-muted",{"text-green-600 font-bold":t==="success","text-red-500 font-bold":t==="error","text-blue-600 font-bold":t==="loading"}))}updatePagePreview(e,t){const i=e>8?e-8:e,s=document.querySelector("#preview-".concat(i));if(!s){console.error("Preview image element for page ".concat(e," (mapped to ").concat(i,") not found"));return}const n=document.querySelector("#content-".concat(i," .placeholder"));n&&(n.style.transition="opacity 0.3s ease",n.style.opacity="0"),s.onload=()=>{s.classList.add("scale-in"),n&&setTimeout(()=>{n.style.display="none"},300)},s.onerror=r=>{console.error("Failed to load page ".concat(e," preview:"),r),n&&(n.style.opacity="1",n.style.display="flex"),h.error("Page ".concat(e," Error"),"Failed to load page preview")};try{s.src=t}catch(r){console.error("Error setting page ".concat(e," preview src:"),r),n&&(n.style.opacity="1",n.style.display="flex")}}hasContent(){const e=document.querySelectorAll(".page-content img");return Array.from(e).some(t=>t.src&&t.src!=="")}toggleSettings(){var t;const e=!((t=this.elements.settingsPanel)!=null&&t.classList.contains("hidden"));this.setSettingsVisible(!e),e||setTimeout(()=>{var s;const i=(s=this.elements.settingsPanel)==null?void 0:s.querySelector("input, button, select, textarea");i==null||i.focus()},100)}setSettingsVisible(e){var t,i;this.elements.settingsPanel&&(e?(this.elements.settingsPanel.classList.remove("hidden"),(t=this.elements.settingsBtn)==null||t.setAttribute("aria-expanded","true")):(this.elements.settingsPanel.classList.add("hidden"),(i=this.elements.settingsBtn)==null||i.setAttribute("aria-expanded","false")))}showActionButtons(){var e,t;(e=this.elements.actionButtons)==null||e.classList.remove("hidden"),(t=this.elements.zine)==null||t.classList.add("has-content"),this.setStatus("PDF processed successfully. Ready to print or export.","success")}hideActionButtons(){var e;(e=this.elements.actionButtons)==null||e.classList.add("hidden"),this.setSettingsVisible(!1)}emit(e,t){this.emitter.emit(e,t)}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}loadSettings(){this.paperSize=localStorage.getItem("paperSize")||"a4",this.orientation=localStorage.getItem("orientation")||"landscape",this.elements.paperSizeSelect&&(this.elements.paperSizeSelect.value=this.paperSize),this.elements.orientationSelect&&(this.elements.orientationSelect.value=this.orientation)}updatePaperSize(e){this.paperSize=e,localStorage.setItem("paperSize",e),this.emitter.emit("paperSizeChanged",{paperSize:e,orientation:this.orientation}),h.info("Paper Size","Changed to ".concat(this.getPaperSizeLabel(e)))}updateOrientation(e){this.orientation=e,localStorage.setItem("orientation",e),this.emitter.emit("orientationChanged",{paperSize:this.paperSize,orientation:e}),h.info("Orientation","Changed to ".concat(e.charAt(0).toUpperCase()+e.slice(1)))}getPaperDimensions(e,t){const i={a4:{width:210,height:297},a3:{width:297,height:420},letter:{width:215.9,height:279.4},legal:{width:215.9,height:355.6},a5:{width:148,height:210}},s=i[e]||i.a4;return t==="portrait"?{width:s.height,height:s.width}:s}getPaperSizeLabel(e){return{a4:"A4",a3:"A3",letter:"Letter",legal:"Legal",a5:"A5"}[e]||"A4"}toggleTabs(e){this.elements.zineTabs&&(e?this.elements.zineTabs.classList.remove("hidden"):this.elements.zineTabs.classList.add("hidden"))}}/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=([a,e,t])=>{const i=document.createElementNS("http://www.w3.org/2000/svg",a);return Object.keys(e).forEach(s=>{i.setAttribute(s,String(e[s]))}),t!=null&&t.length&&t.forEach(s=>{const n=k(s);i.appendChild(n)}),i},U=(a,e={})=>{const t="svg",i={...x,...e};return k([t,i,a])};/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=a=>Array.from(a.attributes).reduce((e,t)=>(e[t.name]=t.value,e),{}),O=a=>typeof a=="string"?a:!a||!a.class?"":a.class&&typeof a.class=="string"?a.class.split(" "):a.class&&Array.isArray(a.class)?a.class:"",R=a=>a.flatMap(O).map(t=>t.trim()).filter(Boolean).filter((t,i,s)=>s.indexOf(t)===i).join(" "),j=a=>a.replace(/(\w)(\w*)(_|-|\s*)/g,(e,t,i)=>t.toUpperCase()+i.toLowerCase()),P=(a,{nameAttr:e,icons:t,attrs:i})=>{var g;const s=a.getAttribute(e);if(s==null)return;const n=j(s),r=t[n];if(!r)return console.warn("".concat(a.outerHTML," icon name was not found in the provided icons object."));const l=N(a),o={...x,"data-lucide":s,...i,...l},p=R(["lucide","lucide-".concat(s),l,i]);p&&Object.assign(o,{class:p});const u=U(r,o);return(g=a.parentNode)==null?void 0:g.replaceChild(u,a)};/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M5 12h14"}],["path",{d:"m12 5 7 7-7 7"}]];/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M12 7v14"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"}]];/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335"}],["path",{d:"m9 11 3 3L22 4"}]];/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"M10 9H8"}],["path",{d:"M16 13H8"}],["path",{d:"M16 17H8"}]];/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]];/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}]];/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"}]];/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"}]];/**
 * @license lucide v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=({icons:a={},nameAttr:e="data-lucide",attrs:t={},root:i=document,inTemplates:s}={})=>{if(!Object.values(a).length)throw new Error("Please provide an icons object.\nIf you want to use all the icons you can import it like:\n `import { createIcons, icons } from 'lucide';\nlucide.createIcons({icons});`");if(typeof i>"u")throw new Error("`createIcons()` only works in a browser environment.");if(Array.from(i.querySelectorAll("[".concat(e,"]"))).forEach(r=>P(r,{nameAttr:e,icons:a,attrs:t})),s&&Array.from(i.querySelectorAll("template")).forEach(l=>E({icons:a,nameAttr:e,attrs:t,root:l.content,inTemplates:s})),e==="data-lucide"){const r=i.querySelectorAll("[icon-name]");r.length>0&&(console.warn("[Lucide] Some icons were found with the now deprecated icon-name attribute. These will still be replaced for backwards compatibility, but will no longer be supported in v1.0 and you should switch to data-lucide"),Array.from(r).forEach(l=>P(l,{nameAttr:"icon-name",icons:a,attrs:t})))}},J="../assets/reference-back-side.jpg";class Q{constructor(){this.pdfProcessor=new B,this.ui=new Z,this.referenceImageUrl=J,this.allPageImages=new Array(16).fill(null),this.init()}async init(){try{await this.pdfProcessor.initialize(),this.setupEventListeners(),this.checkLibraries(),this.generatePagePlaceholders(),this.ui.setStatus("Upload a PDF file to get started","info"),E({icons:{BookOpen:q,FileText:G,Edit:W,Star:Y,ArrowRight:V,ImageIcon:K,CheckCircle:H,Mail:_}})}catch(e){console.error("Initialization error:",e),this.ui.setStatus("Failed to initialize. Please refresh the page and check your internet connection.","error"),h.error("Initialization Error","Failed to load required libraries. Please check your internet connection.")}}setupEventListeners(){var e,t,i;(e=this.ui.elements.pdfUpload)==null||e.addEventListener("change",s=>this.handleFileUpload(s)),this.ui.on("fileSelected",s=>this.processPDF(s.file)),this.ui.on("print",()=>this.handlePrint()),this.ui.on("export",()=>this.handleExport()),this.ui.on("paperSizeChanged",s=>this.updatePaperSettings(s)),this.ui.on("orientationChanged",s=>this.updatePaperSettings(s)),this.ui.on("zineTabChanged",s=>this.updateZineView(s)),(t=this.ui.elements.printBtn)==null||t.addEventListener("click",()=>this.handlePrint()),(i=this.ui.elements.exportPdfBtn)==null||i.addEventListener("click",()=>this.handleExport())}checkLibraries(){const t=Object.entries({"App Modules":!0}).filter(([i,s])=>!s).map(([i])=>i);t.length>0&&(console.warn("Libraries not yet loaded:",t.join(", ")),this.ui.setStatus("Loading required libraries... Please wait.","loading"),setTimeout(()=>this.checkLibraries(),1e3))}generatePagePlaceholders(){const e={1:{title:"Front Cover",desc:"Your story begins here",icon:"book-open"},2:{title:"Inside Front",desc:"Introduction or foreword",icon:"file-text"},3:{title:"Page Content",desc:"Main content area",icon:"edit"},4:{title:"Center Spread",desc:"Focal point of your zine",icon:"star"},5:{title:"More Content",desc:"Continue your story",icon:"arrow-right"},6:{title:"Visual Break",desc:"Artwork or illustration",icon:"image"},7:{title:"Back Inside",desc:"Conclusion or credits",icon:"check-circle"},8:{title:"Back Cover",desc:"Contact info & close",icon:"mail"}},t=[5,4,3,2];for(let i=1;i<=8;i++){const s=document.createElement("article");s.className="fade-in-up",s.style.animationDelay="".concat(i*.1,"s"),t.includes(i)&&s.classList.add("preview-rotated");const n=document.createElement("div");n.className="page-content",n.id="content-".concat(i);const r=document.createElement("div");r.className="page-number",r.textContent=i;const l=document.createElement("div");l.className="placeholder enhanced",l.innerHTML=this.createPlaceholderContent(i,e[i]);const o=document.createElement("img");o.id="preview-".concat(i),o.alt="Page ".concat(i," preview"),n.appendChild(r),n.appendChild(l),n.appendChild(o),s.appendChild(n),this.ui.elements.zine.appendChild(s)}}createPlaceholderContent(e,t){const s={"book-open":"book-open","file-text":"file-text",edit:"edit",star:"star","arrow-right":"arrow-right",image:"image","check-circle":"check-circle",mail:"mail"}[t.icon];return'\n        <div class="placeholder-icon">\n          <i data-lucide="'.concat(s,'" width="48" height="48"></i>\n        </div>\n        <div class="placeholder-content">\n          <h4 class="placeholder-title">').concat(t.title,'</h4>\n          <p class="placeholder-desc">').concat(t.desc,'</p>\n        </div>\n        <div class="placeholder-hint">\n          <span class="hint-text">Upload PDF to see your content here</span>\n          <div class="hint-arrow">\n            <i data-lucide="arrow-right" width="16" height="16"></i>\n          </div>\n        </div>\n      ')}async handleFileUpload(e){const t=e.target.files[0];t&&await this.processPDF(t)}revokePageImages(){this.allPageImages.forEach(e=>{e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}),this.allPageImages.fill(null)}async processPDF(e){var t,i;try{this.ui.showProgress("Starting PDF processing...",0),this.revokePageImages();const s=await this.pdfProcessor.loadPDF(e,c=>{this.ui.showProgress(c)}),{numPages:n,fileName:r,fileSize:l}=s,o=Math.min(16,n);this.ui.setStatus("PDF loaded: ".concat(r," (").concat(v(l),") - ").concat(n," pages")),h.success("PDF Loaded","Successfully loaded ".concat(n," pages"));const p=document.getElementById("zine-tabs");p&&(o>8?(p.classList.remove("hidden"),(t=document.getElementById("zine-tab-1"))==null||t.classList.add("active"),(i=document.getElementById("zine-tab-2"))==null||i.classList.remove("active"),this.currentZine=1):(p.classList.add("hidden"),this.currentZine=1));for(let c=1;c<=o;c++)try{const m=await this.pdfProcessor.renderPage(c,y=>{const D=Math.round((c-1)/o*100);this.ui.showProgress(y,D)}),w=await this.pdfProcessor.canvasToBlob(m),d=URL.createObjectURL(w);this.allPageImages[c-1]=d;const L=(this.currentZine-1)*8,z=this.currentZine*8;if(c>L&&c<=z){const y=c>8?c-8:c;this.ui.updatePagePreview(y,d)}const F=Math.round(c/o*100);this.ui.showProgress("Page ".concat(c," of ").concat(o," converted"),F)}catch(m){console.error("Failed to process page ".concat(c,":"),m),h.warning("Page ".concat(c," Error"),"Using blank page as fallback"),await this.createBlankPage(c)}const u=o>8?16:8;for(let c=o+1;c<=u;c++)await this.createBlankPage(c);this.ui.hideProgress();let g;if(o>8){const m=o-8;g="Created 2 zines: Zine 1 (8 pages) and Zine 2 (".concat(m," pages). Use tabs to switch!")}else{const c=8-o;g=c>0?"Converted ".concat(o," page(s). Filled ").concat(c," blank page(s). Ready to print!"):"Successfully converted all ".concat(o," pages. Ready to print!")}this.ui.setStatus(g,"success"),h.success("Processing Complete",g),this.ui.showActionButtons()}catch(s){console.error("PDF processing error:",s),this.ui.hideProgress(),this.ui.setStatus(s.message,"error"),h.error("Processing Error",s.message)}}async createBlankPage(e){const t=document.createElement("canvas");t.width=1e3,t.height=1400;const i=t.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,1e3,1400),i.font="40px Arial",i.fillStyle="#cccccc",i.textAlign="center",i.fillText("Blank Page",500,700);try{const s=await new Promise(o=>t.toBlob(o,"image/png")),n=URL.createObjectURL(s);this.allPageImages[e-1]=n;const r=(this.currentZine-1)*8,l=this.currentZine*8;if(e>r&&e<=l){const o=e>8?e-8:e;this.ui.updatePagePreview(o,n)}}catch(s){console.error("Error creating blank page blob:",s)}}updateZineView(e){this.currentZine=e;const t=(e-1)*8;for(let i=1;i<=8;i++){const s=t+i-1,n=this.allPageImages[s];n&&this.ui.updatePagePreview(i,n)}}handlePrint(){if(!this.ui.hasContent()){h.error("No Content","Please upload a PDF first before printing");return}try{this.createPrintLayout()}catch(e){console.error("Print error:",e),h.error("Print Error","Failed to create print layout")}}updatePaperSettings(e){this.paperSize=e.paperSize,this.orientation=e.orientation,console.log("Paper settings updated: ".concat(e.paperSize," ").concat(e.orientation))}createPrintLayout(){const e=window.open("","_blank");if(!e){h.error("Popup Blocked","Please allow popups for this site to enable printing");return}const t=this.ui.elements.zine.outerHTML,i="\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Zine Print Layout</title>\n        <style>\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          @page { size: ".concat(this.paperSize||"a4"," ").concat(this.orientation||"landscape",'; margin: 0; }\n          body { margin: 0; padding: 0; width: 100%; height: 100vh; overflow: hidden; }\n          .print-page { width: 100%; height: 100vh; page-break-after: always; position: relative; display: block; }\n          .print-page:last-child { page-break-after: auto; }\n          .front-side { display: grid; grid-template-areas: "page5 page4 page3 page2" "page6 page7 page8 page1"; width: 100%; height: 100%; gap: 0; padding: 0; margin: 0; }\n          .back-side { background-image: url(\'').concat(this.referenceImageUrl,'\'); background-size: contain; background-repeat: no-repeat; background-position: center; transform: rotate(180deg); width: 100%; height: 100%; }\n          .zine { display: grid; grid-template-areas: "page5 page4 page3 page2" "page6 page7 page8 page1"; width: 100%; height: 100%; gap: 0; padding: 0; margin: 0; }\n          .zine > * { width: 100%; height: 100%; border: none; box-shadow: none; display: grid; grid-template-columns: repeat(15, 1fr); grid-template-rows: repeat(21, 1fr); background-color: white; overflow: hidden; position: relative; }\n          .zine > *:nth-child(1) { grid-area: page1; }\n          .zine > *:nth-child(2) { grid-area: page2; }\n          .zine > *:nth-child(3) { grid-area: page3; }\n          .zine > *:nth-child(4) { grid-area: page4; }\n          .zine > *:nth-child(5) { grid-area: page5; }\n          .zine > *:nth-child(6) { grid-area: page6; }\n          .zine > *:nth-child(7) { grid-area: page7; }\n          .zine > *:nth-child(8) { grid-area: page8; }\n          .zine > *:nth-child(8), .zine > *:nth-child(1), .zine > *:nth-child(2), .zine > *:nth-child(7) { transform: rotate(180deg); }\n          .page-content { grid-column: 1 / -1; grid-row: 1 / -1; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; }\n          .page-content img { width: 100%; height: 100%; object-fit: contain; }\n          .page-number { display: none; }\n        </style>\n      </head>\n      <body>\n        <div class="print-page front-side">').concat(t,'</div>\n        <div class="print-page back-side"></div>\n      </body>\n      </html>\n    ');e.document.write(i),e.document.close(),e.focus(),e.print(),e.close()}async handleExport(){if(!this.ui.hasContent()){h.error("No Content","Please upload a PDF first before exporting");return}try{await this.exportAsPDF()}catch(e){console.error("Export error:",e),h.error("Export Error",e.message||"Failed to export PDF")}}async exportAsPDF(){try{this.ui.elements.exportPdfBtn.disabled=!0,this.ui.elements.exportPdfBtn.innerHTML='\n        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">\n          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n        </svg>\n        Exporting...\n      ',h.info("Export Started","Generating PDF... This may take a moment.");const e=this.ui.getPaperDimensions(this.paperSize||"a4",this.orientation||"landscape"),t=document.createElement("div");t.style.position="absolute",t.style.left="-9999px",t.style.top="0",t.style.width=e.width+"mm",t.style.height=e.height+"mm",t.style.background="white",t.style.padding="0",t.style.margin="0";const i=new C({orientation:this.orientation||"landscape",unit:"mm",format:this.paperSize||"a4"});document.body.appendChild(t);const s=async l=>{this.allPageImages.filter(g=>g).length>8&&(this.updateZineView(l),await new Promise(g=>setTimeout(g,100)));const o=this.ui.elements.zine.cloneNode(!0);this.prepareZineForExport(o),t.innerHTML="",t.appendChild(o);const u=(await T(o,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:e.width*4,height:e.height*4})).toDataURL("image/png",1);l>1&&i.addPage(),i.addImage(u,"PNG",0,0,e.width,e.height),i.addPage(),await this.addBackSideToPDF(i)};this.allPageImages.filter(l=>l).length>8?(console.log("Exporting 16-page zine (2 parts)..."),await s(1),await s(2),this.updateZineView(1)):(console.log("Exporting 8-page zine..."),await s(1)),document.body.removeChild(t);const n=new Date().toISOString().slice(0,19).replace(/:/g,"-"),r="zine-export-".concat(n,".pdf");i.save(r),this.ui.elements.exportPdfBtn.disabled=!1,this.ui.elements.exportPdfBtn.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n          <polyline points="7 10 12 15 17 10"></polyline>\n          <line x1="12" y1="15" x2="12" y2="3"></line>\n        </svg>\n        Export PDF\n      ',this.ui.setStatus("PDF exported successfully as ".concat(r),"success"),h.success("Export Complete","Saved as ".concat(r))}catch(e){throw this.ui.elements.exportPdfBtn.disabled=!1,this.ui.elements.exportPdfBtn.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n          <polyline points="7 10 12 15 17 10"></polyline>\n          <line x1="12" y1="15" x2="12" y2="3"></line>\n        </svg>\n        Export PDF\n      ',e}}prepareZineForExport(e){e.style.display="grid",e.style.gridTemplateAreas='"page5 page4 page3 page2" "page6 page7 page8 page1"',e.style.width="100%",e.style.height="100%",e.style.gap="0",e.style.padding="0",e.style.margin="0",e.style.position="fixed",e.style.top="0",e.style.left="0",e.querySelectorAll("article").forEach((s,n)=>{s.style.width="100%",s.style.height="100%",s.style.border="none",s.style.boxShadow="none";const r=n+1;(r===5||r===4||r===3||r===2)&&(s.style.transform="rotate(180deg)")});const i=document.createElement("div");i.style.position="absolute",i.style.top="50%",i.style.left="0",i.style.right="0",i.style.height="2px",i.style.background="repeating-linear-gradient(to right, #000 0px, #000 10px, transparent 10px, transparent 20px)",i.style.zIndex="10",i.style.pointerEvents="none",e.appendChild(i)}async addBackSideToPDF(e){return new Promise((t,i)=>{const s=document.createElement("canvas"),n=s.getContext("2d"),r=this.ui.getPaperDimensions(this.paperSize||"a4",this.orientation||"landscape");s.width=r.width*4,s.height=r.height*4;const l=new Image;l.crossOrigin="anonymous",l.onload=()=>{try{n.save(),n.translate(s.width/2,s.height/2),n.rotate(Math.PI),n.drawImage(l,-s.width/2,-s.height/2,s.width,s.height),n.restore();const o=s.toDataURL("image/png",1),p=this.ui.getPaperDimensions(this.paperSize||"a4",this.orientation||"landscape");e.addImage(o,"PNG",0,0,p.width,p.height),t()}catch(o){i(o)}},l.onerror=()=>i(new Error("Failed to load reference image")),l.src=this.referenceImageUrl})}}document.addEventListener("DOMContentLoaded",()=>{new Q});export{X as __vite_legacy_guard};
//# sourceMappingURL=index-CoJytn0l.js.map
